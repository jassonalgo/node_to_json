<?php

use Drupal\Core\Entity\EntityInterface;
use Drupal\node\NodeInterface;
use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_entity_presave().
 */
function node_to_json_entity_presave(Drupal\Core\Entity\EntityInterface $entity) {
  //get the module config
  $default_config = \Drupal::config('node_to_json.settings');
  $path = $default_config->get('node_to_json.path');
  $data = [];
  //the type of entity is validated
  switch ($entity->bundle()) {
    // Here you modify only your day content type
    case 'static_pages':
      //get data
      if($entity->hasField('field_json_file_name')){
        $title = $entity->get('field_json_file_name')->value;
      }else{
        $title = $entity->getTitle();
      }
      $data['body'] = $entity->get('body')->value;
      $file = file_save_data(json_encode($data), "public://".$path."/".$title.".json", FILE_EXISTS_REPLACE);
      if (is_object($file)) {
        drupal_set_message(t("File created successfully"), 'status');
      }
      else {
        drupal_set_message(t("Error in file creation"), 'error');
      }
      break;
  }
}

/**
 * Implements hook_help().
 */
function node_to_json_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    case 'help.page.node_to_json':
      return t('
        <h2>Node to json.</h2>
        <h3>Description</h3>
        <p>This module allows you to create json files based on the nodes</p>
        <h3>Instructions</h3>
        <pafter updating or creating a node, a json file will be created in the path defined in the administration interface (in construction) following the rules defined in it</p>
      ');
  }
}

?>
